// package com.inmobiliaria.dao;
import com.inmobiliaria.config.MongoDBConnection;
import com.inmobiliaria.model.Propiedad;
import com.mongodb.client.MongoCollection;
import com.mongodb.client.MongoDatabase;
import org.bson.Document;
import org.bson.conversions.Bson;

import java.util.ArrayList;
import java.util.List;

import static com.mongodb.client.model.Filters.eq;

public class PropiedadDAO {
    private final MongoCollection<Document> collection;

    public PropiedadDAO() {
        MongoDatabase db = MongoDBConnection.getInstance().getDatabase();
        this.collection = db.getCollection("propiedades");
    }

    private Document toDocument(Propiedad p) {
        Document doc = new Document("codigo", p.getCodigo())
                .append("tipo", p.getTipo())
                .append("direccion", p.getDireccion())
                .append("precio", p.getPrecio())
                .append("estado", p.getEstado())
                .append("propietarioId", p.getPropietarioId());
        return doc;
    }

    private Propiedad fromDocument(Document doc) {
        if (doc == null) return null;
        Propiedad p = new Propiedad();
        p.setCodigo(doc.getString("codigo"));
        p.setTipo(doc.getString("tipo"));
        p.setDireccion(doc.getString("direccion"));
        p.setPrecio(doc.getDouble("precio"));
        p.setEstado(doc.getString("estado"));
        p.setPropietarioId(doc.getString("propietarioId"));
        return p;
    }

    public void insertar(Propiedad p) {
        collection.insertOne(toDocument(p));
    }

    public List<Propiedad> obtenerTodas() {
        List<Propiedad> lista = new ArrayList<>();
        for (Document d : collection.find()) {
            lista.add(fromDocument(d));
        }
        return lista;
    }

    public Propiedad buscarPorCodigo(String codigo) {
        Document d = collection.find(eq("codigo", codigo)).first();
        return fromDocument(d);
    }

    public void actualizar(Propiedad p) {
        Bson filter = eq("codigo", p.getCodigo());
        collection.replaceOne(filter, toDocument(p));
    }

    public void eliminar(String codigo) {
        collection.deleteOne(eq("codigo", codigo));
    }

    // búsquedas adicionales (por estado, tipo, rango de precio) se agregan aquí
}
